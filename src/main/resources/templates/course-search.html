<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${keyword != null ? 'Hasil Pencarian: ' + keyword : 'Jelajahi Kursus'} + ' - Dikoding Muda'">Jelajahi Kursus - Dikoding Muda</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <style>
        :root {
            --color-primary: #1a56db;
            --color-primary-dark: #1e40af;
            --color-primary-light: #e0e7ff;
            --color-text: #111827;
            --color-text-secondary: #6b7280;
            --color-text-muted: #9ca3af;
            --color-bg: #ffffff;
            --color-bg-subtle: #f9fafb;
            --color-border: #e5e7eb;
            --color-success: #059669;
            --color-warning: #d97706;
            --font-primary: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.05);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            color: var(--color-text);
            background-color: var(--color-bg-subtle);
            line-height: 1.6;
            font-size: 15px;
            -webkit-font-smoothing: antialiased;
        }

        a {
            text-decoration: none;
            color: inherit;
            transition: var(--transition);
        }

        /* Navbar */
        .navbar-main {
            background: var(--color-bg);
            border-bottom: 1px solid var(--color-border);
            padding: 0.875rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .navbar-brand span {
            color: var(--color-primary);
        }

        .nav-link-main {
            color: var(--color-text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
        }

        .nav-link-main:hover {
            color: var(--color-text);
            background: var(--color-bg-subtle);
        }

        .nav-link-main.active {
            color: var(--color-primary);
        }

        .btn-primary-custom {
            background: var(--color-primary);
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            padding: 0.625rem 1.25rem;
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary-custom:hover {
            background: var(--color-primary-dark);
            color: white;
            transform: translateY(-1px);
        }

        .btn-outline-custom {
            background: transparent;
            color: var(--color-text);
            font-weight: 500;
            font-size: 0.875rem;
            padding: 0.625rem 1.25rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--color-border);
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-outline-custom:hover {
            background: var(--color-bg-subtle);
            border-color: var(--color-text-muted);
        }

        /* Search Header */
        .search-header {
            background: var(--color-bg);
            padding: 2rem 0;
            border-bottom: 1px solid var(--color-border);
        }

        .search-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 0.5rem;
        }

        .search-subtitle {
            font-size: 0.9375rem;
            color: var(--color-text-secondary);
        }

        .search-keyword {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* Search Form */
        .search-form-wrapper {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
            max-width: 600px;
        }

        .search-input {
            flex: 1;
            border: none;
            padding: 0.75rem 1rem;
            font-size: 0.9375rem;
            font-family: inherit;
            background: transparent;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--color-text-muted);
        }

        .search-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-btn:hover {
            background: var(--color-primary-dark);
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0 4rem;
        }

        /* Sidebar Filter */
        .filter-sidebar {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            position: sticky;
            top: 90px;
        }

        .filter-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .filter-reset {
            font-size: 0.8125rem;
            color: var(--color-primary);
            font-weight: 500;
            cursor: pointer;
        }

        .filter-reset:hover {
            text-decoration: underline;
        }

        .filter-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--color-border);
        }

        .filter-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .filter-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.875rem;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            padding: 0.5rem 0;
            cursor: pointer;
        }

        .filter-option input[type="checkbox"],
        .filter-option input[type="radio"] {
            width: 16px;
            height: 16px;
            accent-color: var(--color-primary);
            cursor: pointer;
        }

        .filter-option label {
            font-size: 0.875rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            flex: 1;
        }

        .filter-option-count {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            background: var(--color-bg-subtle);
            padding: 0.125rem 0.5rem;
            border-radius: 100px;
        }

        /* Rating Filter */
        .rating-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rating-stars {
            color: #fbbf24;
            font-size: 0.875rem;
            letter-spacing: -1px;
        }

        .star-filled {
            color: #fbbf24;
        }

        .star-empty {
            color: #d1d5db;
        }

        .rating-text {
            font-size: 0.8125rem;
            color: var(--color-text-muted);
        }

        /* Results Header */
        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .results-count {
            font-size: 0.9375rem;
            color: var(--color-text-secondary);
        }

        .results-count strong {
            color: var(--color-text);
            font-weight: 600;
        }

        .results-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sort-select {
            padding: 0.625rem 2rem 0.625rem 1rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-family: inherit;
            background: var(--color-bg);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .view-toggle {
            display: flex;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .view-toggle-btn {
            padding: 0.5rem 0.75rem;
            border: none;
            background: var(--color-bg);
            cursor: pointer;
            color: var(--color-text-muted);
            transition: var(--transition);
        }

        .view-toggle-btn:hover {
            background: var(--color-bg-subtle);
        }

        .view-toggle-btn.active {
            background: var(--color-primary);
            color: white;
        }

        /* Course Card */
        .course-card {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .course-card:hover {
            box-shadow: var(--shadow-md);
            border-color: transparent;
            transform: translateY(-2px);
        }

        .course-thumbnail {
            aspect-ratio: 16/9;
            background: var(--color-bg-subtle);
            position: relative;
            overflow: hidden;
        }

        .course-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .course-thumbnail-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: var(--color-text-muted);
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }

        .course-badge {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            padding: 0.25rem 0.625rem;
            background: var(--color-bg);
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--color-text);
        }

        .course-badge.new {
            background: var(--color-primary);
            color: white;
        }

        .course-badge.bestseller {
            background: var(--color-warning);
            color: white;
        }

        .course-badge.free {
            background: var(--color-success);
            color: white;
        }

        .course-content {
            padding: 1.25rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .course-category {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-primary);
            margin-bottom: 0.5rem;
        }

        .course-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.5rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .course-title a:hover {
            color: var(--color-primary);
        }

        .course-instructor {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            margin-bottom: 0.75rem;
        }

        .course-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-bottom: 0.75rem;
        }

        .course-meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .course-rating {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            margin-bottom: 0.75rem;
        }

        .rating-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text);
        }

        .rating-count {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        .course-footer {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .course-price {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .course-price.free {
            color: var(--color-success);
        }

        .course-price-original {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            text-decoration: line-through;
            margin-left: 0.5rem;
        }

        .course-action {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--color-border);
            background: var(--color-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--color-text-muted);
        }

        .course-action:hover {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        /* Course Students Badge */
        .course-students {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }

        /* List View */
        .course-card-list {
            flex-direction: row;
        }

        .course-card-list .course-thumbnail {
            width: 280px;
            flex-shrink: 0;
            aspect-ratio: auto;
            height: 100%;
            min-height: 180px;
        }

        .course-card-list .course-content {
            padding: 1.5rem;
        }

        .course-card-list .course-title {
            font-size: 1.125rem;
            -webkit-line-clamp: 1;
        }

        .course-card-list .course-description {
            font-size: 0.875rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.75rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Pagination */
        .pagination-wrapper {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
        }

        .pagination {
            display: flex;
            gap: 0.375rem;
        }

        .page-link {
            padding: 0.625rem 1rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            background: var(--color-bg);
            transition: var(--transition);
        }

        .page-link:hover {
            background: var(--color-bg-subtle);
            color: var(--color-text);
        }

        .page-item.active .page-link {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        .page-item.disabled .page-link {
            color: var(--color-text-muted);
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
        }

        .empty-state-icon {
            width: 80px;
            height: 80px;
            background: var(--color-bg-subtle);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: var(--color-text-muted);
        }

        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.5rem;
        }

        .empty-state-text {
            font-size: 0.9375rem;
            color: var(--color-text-secondary);
            margin-bottom: 1.5rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Mobile Filter Toggle */
        .filter-toggle-mobile {
            display: none;
            width: 100%;
            padding: 0.875rem 1.25rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--color-text);
            cursor: pointer;
            margin-bottom: 1rem;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }

        /* Active Filters */
        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .active-filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            background: var(--color-primary-light);
            border-radius: 100px;
            font-size: 0.8125rem;
            color: var(--color-primary-dark);
        }

        .active-filter-remove {
            cursor: pointer;
            opacity: 0.7;
        }

        .active-filter-remove:hover {
            opacity: 1;
        }

        /* Footer */
        .footer {
            background: var(--color-bg);
            border-top: 1px solid var(--color-border);
            padding: 2rem 0;
            margin-top: auto;
        }

        .footer-text {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            text-align: center;
        }

        /* User Dropdown */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--color-primary);
            font-size: 0.875rem;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--color-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }

        .dropdown:hover .dropdown-menu {
            display: block;
            margin-top: 0;
        }

        /* Apply Filter Button */
        .apply-filter-btn {
            width: 100%;
            padding: 0.875rem;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            transition: var(--transition);
        }

        .apply-filter-btn:hover {
            background: var(--color-primary-dark);
        }

        /* Responsive */
        @media (max-width: 991px) {
            .filter-sidebar {
                position: fixed;
                top: 0;
                left: -100%;
                width: 320px;
                height: 100vh;
                z-index: 1100;
                border-radius: 0;
                overflow-y: auto;
                transition: left 0.3s ease;
            }

            .filter-sidebar.show {
                left: 0;
            }

            .filter-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1050;
            }

            .filter-overlay.show {
                display: block;
            }

            .filter-toggle-mobile {
                display: flex;
            }

            .filter-close {
                display: block;
            }

            .course-card-list .course-thumbnail {
                width: 200px;
            }
        }

        @media (max-width: 767px) {
            .search-header {
                padding: 1.5rem 0;
            }

            .search-title {
                font-size: 1.5rem;
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .course-card-list {
                flex-direction: column;
            }

            .course-card-list .course-thumbnail {
                width: 100%;
                aspect-ratio: 16/9;
                min-height: auto;
            }

            .view-toggle {
                display: none;
            }
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar-main">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between">
                <a href="/" class="navbar-brand">
                    Dikoding<span>Muda</span>
                </a>
                
                <div class="d-none d-lg-flex align-items-center gap-1">
                    <a href="/courses" class="nav-link-main active">Kursus</a>
                    <a href="/categories" class="nav-link-main">Kategori</a>
                    <a href="/instructors" class="nav-link-main">Pengajar</a>
                    <a href="/about" class="nav-link-main">Tentang</a>
                </div>
                
                <div class="d-flex align-items-center gap-2">
                    <a href="/login" class="btn-outline-custom d-none d-sm-inline-block" th:if="${user == null}">Masuk</a>
                    <a href="/register" class="btn-primary-custom" th:if="${user == null}">Daftar Gratis</a>
                    
                    <!-- User Dropdown -->
                    <div class="dropdown text-end" th:if="${user != null}">
                        <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="userDropdown">
                            <div class="user-profile">
                                <div class="user-info">
                                    <div class="user-name" th:text="${user.firstName + ' ' + user.lastName}"></div>
                                    <div class="user-role" th:text="${role}"></div>
                                </div>
                                <div class="user-avatar" th:text="${#strings.substring(user.firstName, 0, 1) + #strings.substring(user.lastName, 0, 1)}"></div>
                            </div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:if="${role == 'Lecturer'}" href="/lecturer/dashboard">Dashboard</a></li>
                            <li><a class="dropdown-item" th:if="${role == 'Admin'}" href="/admin/dashboard">Dashboard</a></li>
                            <li><a class="dropdown-item" th:if="${role == 'Student'}" href="/my-account">My Account</a></li>
                            <li><a class="dropdown-item" th:if="${role == 'Student'}" href="/my-courses">My Courses</a></li>
                            <li><a class="dropdown-item" th:if="${role == 'Student'}" href="/wishlist">Wishlist</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="/logout">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Search Header -->
    <section class="search-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 mb-3 mb-lg-0">
                    <h1 class="search-title" th:if="${keyword != null}">
                        Hasil Pencarian: <span class="search-keyword" th:text="${keyword}"></span>
                    </h1>
                    <h1 class="search-title" th:if="${keyword == null}">Jelajahi Kursus</h1>
                    <p class="search-subtitle mb-0">
                        <span th:if="${totalElements != null}">
                            Ditemukan <strong th:text="${totalElements}">0</strong> kursus
                            <span th:if="${keyword != null}">untuk pencarian "<span th:text="${keyword}"></span>"</span>
                        </span>
                        <span th:if="${totalElements == null}">Temukan kursus pemrograman terbaik untuk meningkatkan skill kamu</span>
                    </p>
                </div>
                <div class="col-lg-6">
                    <form th:action="@{/courses/search}" method="get" class="search-form-wrapper">
                        <input type="text" name="keyword" class="search-input" 
                               placeholder="Cari kursus, topik, atau pengajar..." 
                               th:value="${keyword}">
                        <button type="submit" class="search-btn">Cari</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="main-content">
        <div class="container">
            <!-- Mobile Filter Toggle -->
            <button class="filter-toggle-mobile" onclick="toggleFilter()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                Filter & Urutkan
            </button>

            <!-- Filter Overlay (Mobile) -->
            <div class="filter-overlay" id="filterOverlay" onclick="toggleFilter()"></div>

            <div class="row">
                <!-- Sidebar Filter -->
                <div class="col-lg-3">
                    <div class="filter-sidebar" id="filterSidebar">
                        <div class="filter-title">
                            <span>Filter</span>
                            <a th:href="@{/courses/search}" class="filter-reset">Reset</a>
                        </div>

                        <form id="filterForm" th:action="@{/courses/search}" method="get">
                            <input type="hidden" name="keyword" th:value="${keyword}">

                            <!-- Category Filter -->
                            <div class="filter-section">
                                <div class="filter-section-title">Kategori</div>
                                <div th:each="category : ${categories}">
                                    <div class="filter-option">
                                        <input type="checkbox" 
                                               th:id="${'cat-' + category.categoryId}" 
                                               name="categoryIds" 
                                               th:value="${category.categoryId}"
                                               th:checked="${selectedCategoryIds != null && selectedCategoryIds.contains(category.categoryId)}">
                                        <label th:for="${'cat-' + category.categoryId}" th:text="${category.name}">Web Development</label>
                                        <span class="filter-option-count" th:text="${category.courseCount}" th:if="${category.courseCount != null}">42</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Level Filter -->
                            <div class="filter-section">
                                <div class="filter-section-title">Level</div>
                                <div class="filter-option">
                                    <input type="checkbox" id="level-beginner" name="levels" value="beginner"
                                           th:checked="${selectedLevels != null && selectedLevels.contains('beginner')}">
                                    <label for="level-beginner">Pemula</label>
                                </div>
                                <div class="filter-option">
                                    <input type="checkbox" id="level-intermediate" name="levels" value="intermediate"
                                           th:checked="${selectedLevels != null && selectedLevels.contains('intermediate')}">
                                    <label for="level-intermediate">Menengah</label>
                                </div>
                                <div class="filter-option">
                                    <input type="checkbox" id="level-advanced" name="levels" value="advanced"
                                           th:checked="${selectedLevels != null && selectedLevels.contains('advanced')}">
                                    <label for="level-advanced">Mahir</label>
                                </div>
                            </div>

                            <!-- Rating Filter -->
                            <div class="filter-section">
                                <div class="filter-section-title">Rating</div>
                                <div class="filter-option">
                                    <input type="radio" id="rating-all" name="minRating" value=""
                                           th:checked="${minRating == null}">
                                    <label for="rating-all">Semua Rating</label>
                                </div>
                                <div class="filter-option">
                                    <input type="radio" id="rating-4" name="minRating" value="4"
                                           th:checked="${minRating == 4}">
                                    <label for="rating-4" class="rating-option">
                                        <span class="rating-text">4.0 ke atas</span>
                                    </label>
                                </div>
                                <div class="filter-option">
                                    <input type="radio" id="rating-3" name="minRating" value="3"
                                           th:checked="${minRating == 3}">
                                    <label for="rating-3" class="rating-option">
                                        <span class="rating-text">3.0 ke atas</span>
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="apply-filter-btn">Terapkan Filter</button>
                        </form>
                    </div>
                </div>

                <!-- Course Results -->
                <div class="col-lg-9">
                    <!-- Active Filters -->
                    <div class="active-filters" th:if="${hasActiveFilters}">
                        <div class="active-filter-tag" th:each="catName : ${selectedCategoryNames}">
                            <span th:text="${catName}">Web Development</span>
                            <span class="active-filter-remove">x</span>
                        </div>
                        <div class="active-filter-tag" th:if="${priceType == 'free'}">
                            <span>Gratis</span>
                            <span class="active-filter-remove">x</span>
                        </div>
                        <div class="active-filter-tag" th:if="${priceType == 'paid'}">
                            <span>Berbayar</span>
                            <span class="active-filter-remove">x</span>
                        </div>
                        <div class="active-filter-tag" th:each="level : ${selectedLevels}">
                            <span th:text="${level == 'beginner' ? 'Pemula' : (level == 'intermediate' ? 'Menengah' : 'Mahir')}">Pemula</span>
                            <span class="active-filter-remove">x</span>
                        </div>
                    </div>

                    <!-- Results Header -->
                    <div class="results-header">
                        <div class="results-count">
                            Menampilkan <strong th:text="${courses != null ? courses.size() : 0}">12</strong> dari 
                            <strong th:text="${totalElements != null ? totalElements : 0}">128</strong> kursus
                        </div>
                        <div class="results-actions">
                            <select class="sort-select" name="sort" onchange="updateSort(this.value)">
                                <option value="newest" th:selected="${sort == 'newest'}">Terbaru</option>
                                <option value="popular" th:selected="${sort == 'popular'}">Paling Populer</option>
                                <option value="rating" th:selected="${sort == 'rating'}">Rating Tertinggi</option>
                                <option value="price-low" th:selected="${sort == 'price-low'}">Harga: Rendah ke Tinggi</option>
                                <option value="price-high" th:selected="${sort == 'price-high'}">Harga: Tinggi ke Rendah</option>
                            </select>
                            <div class="view-toggle">
                                <button type="button" class="view-toggle-btn active" id="gridViewBtn" onclick="setView('grid')">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="14" width="7" height="7"></rect>
                                        <rect x="3" y="14" width="7" height="7"></rect>
                                    </svg>
                                </button>
                                <button type="button" class="view-toggle-btn" id="listViewBtn" onclick="setView('list')">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="8" y1="6" x2="21" y2="6"></line>
                                        <line x1="8" y1="12" x2="21" y2="12"></line>
                                        <line x1="8" y1="18" x2="21" y2="18"></line>
                                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Course Grid - Menggunakan CourseWithStatsDTO -->
                    <div class="row g-4" id="courseContainer" th:if="${courses != null && !courses.isEmpty()}">
                        <div class="col-md-6 col-lg-4 course-item" th:each="course : ${courses}">
                            <div class="course-card">
                                <div class="course-thumbnail">
                                    <a th:href="@{/courses/{slug}(slug=${course.slug})}">
                                        <img th:if="${course.thumbnailUrl != null}" 
                                             th:src="@{/files/view(path=${course.thumbnailUrl})}" 
                                             th:alt="${course.title}">
                                        <div th:if="${course.thumbnailUrl == null}" class="course-thumbnail-placeholder">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                                <polyline points="21 15 16 10 5 21"></polyline>
                                            </svg>
                                        </div>
                                    </a>
                                    
                                    <!-- Badge -->
                                    <span th:if="${course.price != null && course.price.compareTo(T(java.math.BigDecimal).ZERO) == 0 && course.discountPrice == null}" class="course-badge free">Gratis</span>
                                </div>
                                <div class="course-content">
                                    <!-- Kategori -->
                                    <div class="course-category" th:text="${course.categoryName}">Web Development</div>
                                    
                                    <!-- Judul -->
                                    <h3 class="course-title">
                                        <a th:href="@{/courses/{slug}(slug=${course.slug})}" th:text="${course.title}">
                                            Belajar Dasar Pemrograman JavaScript
                                        </a>
                                    </h3>
                                    
                                    <!-- Instructor -->
                                    <div class="course-instructor" th:if="${course.lecturerName != null}" th:text="${course.lecturerName}">Budi Santoso</div>
                                    
                                    <!-- Rating -->
                                    <div class="course-rating">
                                        <span class="rating-stars">
                                            <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                                                <span th:if="${course.averageRating != null && i <= course.averageRating.intValue()}" class="star-filled">&#9733;</span>
                                                <span th:if="${course.averageRating == null || i > course.averageRating.intValue()}" class="star-empty">&#9733;</span>
                                            </th:block>
                                        </span>
                                        <span class="rating-value" th:text="${course.averageRating != null && course.averageRating > 0 ? #numbers.formatDecimal(course.averageRating, 1, 1) : '-'}">4.8</span>
                                        <span class="rating-count" th:text="${'(' + (course.totalReviews != null ? course.totalReviews : 0) + ')'}">(1,234)</span>
                                    </div>
                                    
                                    <!-- Meta Info -->
                                    <div class="course-meta">
                                        <!-- Durasi -->
                                        <span class="course-meta-item" th:with="hours=${course.totalDuration != null ? course.totalDuration / 60 : 0}, mins=${course.totalDuration != null ? course.totalDuration % 60 : 0}">
                                            <span th:if="${hours > 0}" th:text="${hours + ' Jam'}">12 Jam</span>
                                            <span th:if="${hours == 0 && mins > 0}" th:text="${mins + ' Menit'}">30 Menit</span>
                                            <span th:if="${hours == 0 && mins == 0}">-</span>
                                        </span>
                                        
                                        <!-- Total Lessons -->
                                        <span class="course-meta-item" th:text="${(course.totalLessons != null ? course.totalLessons : 0) + ' Materi'}">24 Materi</span>
                                        
                                        <!-- Level -->
                                        <span class="course-meta-item" th:switch="${course.level}">
                                            <span th:case="'beginner'">Pemula</span>
                                            <span th:case="'intermediate'">Menengah</span>
                                            <span th:case="'advanced'">Mahir</span>
                                            <span th:case="*">-</span>
                                        </span>
                                    </div>
                                    
                                    <!-- Footer -->
                                    <div class="course-footer">
                                        <div>
                                            <!-- Jika ada diskon -->
                                            <th:block th:if="${course.discountPrice != null}">
                                                <span class="course-price" th:text="'Rp ' + ${#numbers.formatInteger(course.discountPrice, 1, 'POINT')}">Rp 199.000</span>
                                                <span class="course-price-original" th:text="'Rp ' + ${#numbers.formatInteger(course.price, 1, 'POINT')}">Rp 499.000</span>
                                            </th:block>
                                            
                                            <!-- Jika tidak ada diskon -->
                                            <th:block th:if="${course.discountPrice == null}">
                                                <!-- Gratis -->
                                                <span th:if="${course.price == null || course.price.compareTo(T(java.math.BigDecimal).ZERO) == 0}" class="course-price free">Gratis</span>
                                                <!-- Berbayar -->
                                                <span th:if="${course.price != null && course.price.compareTo(T(java.math.BigDecimal).ZERO) > 0}" class="course-price" th:text="'Rp ' + ${#numbers.formatInteger(course.price, 1, 'POINT')}">Rp 199.000</span>
                                            </th:block>
                                        </div>
                                        
                                        <!-- Total Students & Cart Button -->
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="course-students" th:if="${course.totalStudents != null && course.totalStudents > 0}" th:title="${course.totalStudents + ' siswa terdaftar'}">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                    <circle cx="9" cy="7" r="4"></circle>
                                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                                </svg>
                                                <span th:text="${course.totalStudents >= 1000 ? #numbers.formatDecimal(course.totalStudents / 1000.0, 1, 1) + 'K' : course.totalStudents}">1.2K</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div class="empty-state" th:if="${courses == null || courses.isEmpty()}">
                        <div class="empty-state-icon">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </svg>
                        </div>
                        <h3 class="empty-state-title">Tidak Ada Kursus Ditemukan</h3>
                        <p class="empty-state-text">
                            <span th:if="${keyword != null}">Maaf, tidak ada kursus yang cocok dengan pencarian "<strong th:text="${keyword}"></strong>". Coba gunakan kata kunci lain atau hapus beberapa filter.</span>
                            <span th:if="${keyword == null}">Tidak ada kursus yang sesuai dengan filter yang dipilih. Coba hapus beberapa filter atau jelajahi semua kursus.</span>
                        </p>
                        <a th:href="@{/courses}" class="btn-primary-custom">Lihat Semua Kursus</a>
                    </div>

                    <!-- Pagination -->
                    <nav class="pagination-wrapper" th:if="${totalPages != null && totalPages > 1}">
                        <ul class="pagination">
                            <li class="page-item" th:classappend="${currentPage == 0 ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{/courses/search(keyword=${keyword}, page=${currentPage - 1}, sort=${sort}, categoryIds=${selectedCategoryIds}, levels=${selectedLevels}, minRating=${minRating})}">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </a>
                            </li>
                            
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}" 
                                th:if="${i == 0 || i == totalPages - 1 || (i >= currentPage - 2 && i <= currentPage + 2)}"
                                th:classappend="${i == currentPage ? 'active' : ''}">
                                <a class="page-link" 
                                   th:href="@{/courses/search(keyword=${keyword}, page=${i}, sort=${sort}, categoryIds=${selectedCategoryIds}, levels=${selectedLevels}, minRating=${minRating})}"
                                   th:text="${i + 1}">1</a>
                            </li>
                            
                            <li class="page-item" th:classappend="${currentPage >= totalPages - 1 ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{/courses/search(keyword=${keyword}, page=${currentPage + 1}, sort=${sort}, categoryIds=${selectedCategoryIds}, levels=${selectedLevels}, minRating=${minRating})}">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="9 18 15 12 9 6"></polyline>
                                    </svg>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="footer-text">2025 Dikoding Muda Nusantara. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script>
        // Toggle mobile filter
        function toggleFilter() {
            const sidebar = document.getElementById('filterSidebar');
            const overlay = document.getElementById('filterOverlay');
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        // View toggle (grid/list)
        function setView(view) {
            const container = document.getElementById('courseContainer');
            const gridBtn = document.getElementById('gridViewBtn');
            const listBtn = document.getElementById('listViewBtn');
            const courseItems = document.querySelectorAll('.course-item');
            const courseCards = document.querySelectorAll('.course-card');

            if (view === 'list') {
                gridBtn.classList.remove('active');
                listBtn.classList.add('active');
                courseItems.forEach(item => {
                    item.classList.remove('col-md-6', 'col-lg-4');
                    item.classList.add('col-12');
                });
                courseCards.forEach(card => {
                    card.classList.add('course-card-list');
                });
            } else {
                listBtn.classList.remove('active');
                gridBtn.classList.add('active');
                courseItems.forEach(item => {
                    item.classList.remove('col-12');
                    item.classList.add('col-md-6', 'col-lg-4');
                });
                courseCards.forEach(card => {
                    card.classList.remove('course-card-list');
                });
            }

            // Save preference
            localStorage.setItem('courseViewPreference', view);
        }

        // Update sort
        function updateSort(value) {
            const url = new URL(window.location.href);
            url.searchParams.set('sort', value);
            window.location.href = url.toString();
        }

        // Add to cart
        function addToCart(courseId) {
            fetch('/api/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ courseId: courseId })
            })
            .then(response => {
                if (response.ok) {
                    alert('Kursus berhasil ditambahkan ke keranjang!');
                } else if (response.status === 401) {
                    window.location.href = '/login?redirect=' + encodeURIComponent(window.location.href);
                } else {
                    alert('Gagal menambahkan ke keranjang. Silakan coba lagi.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan. Silakan coba lagi.');
            });
        }

        // Load view preference
        document.addEventListener('DOMContentLoaded', function() {
            const savedView = localStorage.getItem('courseViewPreference');
            if (savedView) {
                setView(savedView);
            }
        });
    </script>
</body>
</html>